# AI智能体工作指南

## 1. 概述

本指南旨在为AI智能体提供结构化、可执行的工作框架，确保AI智能体在执行项目任务时严格遵循项目管理规范，保证工作质量和可追溯性。

## 2. 工作任务分解与优先级排序

### 2.1 任务分解原则

- **SMART原则**：任务应具备明确性(Specific)、可衡量性(Measurable)、可达成性(Achievable)、相关性(Relevant)和时限性(Time-bound)
- **模块化分解**：将复杂任务分解为独立的、可管理的模块
- **依赖关系明确**：识别任务间的依赖关系，确保按正确顺序执行

### 2.2 任务优先级排序

采用MoSCoW方法进行优先级排序：

| 优先级 | 描述 |
|--------|------|
| Must Have | 必须完成的核心任务，直接影响项目目标实现 |
| Should Have | 应该完成的重要任务，对项目有显著价值 |
| Could Have | 可以完成的次要任务，对项目有一定价值 |
| Won't Have | 暂时不会完成的任务，可推迟到后续迭代 |

### 2.3 任务示例

```markdown
# 任务列表

## Must Have
1. 实现爬虫核心功能（依赖：配置文件）
2. 实现HTML到Markdown转换（依赖：爬虫核心功能）
3. 实现图片下载功能（依赖：爬虫核心功能）

## Should Have
1. 添加日志记录功能
2. 实现断点续爬功能
3. 添加错误处理机制

## Could Have
1. 实现多线程爬取
2. 添加测试用例
3. 优化爬取速度

## Won't Have
1. 实现分布式爬取
2. 添加Web界面
```

## 3. 执行流程

### 3.1 启动阶段

1. **任务理解**：仔细阅读任务描述，明确任务目标和要求
2. **环境准备**：确保开发环境配置正确，依赖安装完整
3. **代码拉取**：从Git仓库拉取最新代码，切换到正确的分支
4. **计划制定**：使用TodoWrite工具创建详细的任务计划

### 3.2 开发阶段

1. **分支管理**：
   - 从`develop`分支创建功能分支，命名格式：`feature/功能描述`
   - 例如：`feature/implement-crawler-core`

2. **代码实现**：
   - 遵循项目的代码风格指南
   - 编写清晰、可维护的代码
   - 添加适当的注释（解释"为什么"，而不是"如何"）
   - 实现所有需求功能，处理边界情况

3. **测试**：
   - 编写单元测试，确保测试覆盖率不低于80%
   - 运行所有测试，确保测试通过
   - 进行手动测试，验证功能完整性

4. **代码审查**：
   - 提交代码到远程仓库
   - 创建Pull Request，填写完整的PR模板
   - 至少指定1名审查者
   - 根据审查反馈进行修改

### 3.3 发布阶段

1. **版本准备**：
   - 更新CHANGELOG.md文件
   - 运行所有测试，确保测试通过
   - 检查代码质量

2. **版本发布**：
   - 从develop分支创建发布分支，命名格式：`release/vX.Y.Z`
   - 合并到main分支
   - 创建版本标签：`vX.Y.Z`
   - 推送标签到远程仓库
   - 合并到develop分支
   - 删除发布分支

## 4. 工作留痕标准

### 4.1 操作记录

- **TodoWrite工具**：使用TodoWrite工具记录所有任务的执行情况，包括：
  - 任务描述
  - 状态（pending/in_progress/completed）
  - 优先级
  - 完成时间

- **命令记录**：记录所有执行的重要命令，包括：
  - 代码拉取和推送命令
  - 测试运行命令
  - 构建和部署命令

### 4.2 决策依据

- **设计文档**：记录重要的设计决策，包括：
  - 技术选型理由
  - 架构设计方案
  - 算法选择依据

- **变更记录**：记录所有重要的变更，包括：
  - 需求变更
  - 设计变更
  - 代码变更

### 4.3 中间成果文档

- **测试报告**：记录测试结果，包括：
  - 测试用例数量
  - 通过率
  - 失败原因

- **日志文件**：保留所有日志文件，包括：
  - 运行日志
  - 错误日志
  - 调试日志

- **临时文件**：保留重要的临时文件，包括：
  - 数据样本
  - 测试数据
  - 调试信息

## 5. 阶段性成果提交节点

### 5.1 每日提交

- **频率**：每日至少提交1次代码
- **内容**：当天完成的工作内容
- **提交信息**：遵循Conventional Commits规范

### 5.2 每周报告

- **频率**：每周五提交周报
- **内容**：
  - 本周完成的工作
  - 下周计划
  - 遇到的问题和解决方案
  - 需要的支持

### 5.3 里程碑提交

- **频率**：每个里程碑完成时提交
- **内容**：
  - 里程碑完成情况
  - 交付的成果物
  - 测试报告
  - 质量评估

## 6. 人工审阅触发机制及反馈响应流程

### 6.1 人工审阅触发机制

| 触发条件 | 审阅类型 | 审阅者 |
|----------|----------|--------|
| 代码提交 | 代码审查 | 至少1名团队成员 |
| Pull Request创建 | PR审查 | 至少1名团队成员 |
| 版本发布 | 版本审查 | 项目负责人 |
| 重大设计决策 | 设计审查 | 技术负责人 |
| 每周报告 | 进度审查 | 项目负责人 |

### 6.2 反馈响应流程

1. **反馈接收**：及时接收人工审阅反馈
2. **反馈分析**：分析反馈内容，理解要求和建议
3. **反馈响应**：
   - 对于需要修改的内容，制定修改计划
   - 对于有疑问的内容，及时沟通澄清
   - 对于认可的内容，确认接收
4. **修改实施**：按照修改计划进行修改
5. **修改验证**：验证修改是否符合要求
6. **反馈闭环**：将修改结果反馈给审阅者，确认问题解决

### 6.3 反馈响应时间

- 对于紧急反馈，应在2小时内响应
- 对于一般反馈，应在24小时内响应
- 对于复杂问题，应在48小时内给出解决方案

## 7. 代码规范

### 7.1 命名规范

- **变量名**：使用小写字母和下划线（snake_case），具有描述性
- **函数名**：使用小写字母和下划线（snake_case），动词开头
- **类名**：使用首字母大写（PascalCase）
- **模块名**：使用小写字母和下划线（snake_case）

### 7.2 代码风格

- **缩进**：使用4个空格进行缩进
- **换行**：每行不超过80个字符
- **空行**：在函数、类、逻辑块之间添加适当的空行
- **注释**：使用#添加单行注释，"""添加多行注释

### 7.3 最佳实践

- 遵循单一职责原则，每个函数/类只负责一个功能
- 避免重复代码，使用函数、类或模块复用代码
- 处理所有可能的错误，使用try-except块捕获异常
- 使用日志记录重要信息，而不是print语句
- 编写测试用例，确保代码质量

## 8. 配置管理

### 8.1 配置文件格式

- 使用JSON格式存储配置
- 配置文件命名：`功能_config.json`，例如：`crawl_config.json`
- 配置文件集中存放于`config/`目录

### 8.2 配置内容

配置文件应包含以下内容：

```json
{
  "start_url": "https://example.com",
  "max_concurrent": 5,
  "request_delay": 1,
  "output_dir": "data/markdown",
  "log_level": "INFO",
  "timeout": 30,
  "retry_count": 3
}
```

### 8.3 配置读取

使用统一的配置读取函数，确保配置的一致性和可维护性：

```python
import json
import os

def read_config(config_name):
    """读取配置文件"""
    config_path = os.path.join("config", f"{config_name}_config.json")
    with open(config_path, "r", encoding="utf-8") as f:
        return json.load(f)
```

## 9. 日志管理

### 9.1 日志格式

- 日志格式：`[时间] [级别] [模块] 消息`
- 时间格式：`YYYY-MM-DD HH:MM:SS`
- 级别：DEBUG, INFO, WARNING, ERROR, CRITICAL

### 9.2 日志配置

```python
import logging
import os

def setup_logger():
    """设置日志配置"""
    log_dir = "logs"
    os.makedirs(log_dir, exist_ok=True)
    
    logging.basicConfig(
        level=logging.INFO,
        format='[%(asctime)s] [%(levelname)s] [%(module)s] %(message)s',
        handlers=[
            logging.FileHandler(os.path.join(log_dir, 'app.log')),
            logging.StreamHandler()
        ]
    )
    
    return logging.getLogger(__name__)
```

### 9.3 日志使用

- 在关键节点记录日志
- 记录重要的操作和决策
- 记录错误和异常信息
- 避免记录敏感信息

## 10. 测试管理

### 10.1 测试框架

使用pytest框架编写测试用例

### 10.2 测试文件结构

```
tests/
├── test_crawler/         # 爬虫模块测试
├── test_parser/          # 解析器模块测试
├── test_downloader/      # 下载器模块测试
└── conftest.py           # 测试配置
```

### 10.3 测试用例编写

- 测试用例应覆盖正常情况和异常情况
- 测试用例应具有描述性名称
- 测试用例应独立运行，不依赖外部资源

### 10.4 测试运行

```bash
# 运行所有测试
pytest

# 运行指定模块的测试
pytest tests/test_crawler/

# 运行指定测试用例
pytest tests/test_crawler/test_spider.py::test_get_page

# 生成测试覆盖率报告
pytest --cov=src tests/
```

## 11. 文档管理

### 11.1 文档格式

- 使用Markdown格式编写文档
- 文档文件使用描述性名称
- 文档应包含目录、标题、正文和示例

### 11.2 文档更新

- 代码变更时同步更新相关文档
- 版本发布时更新CHANGELOG.md
- 定期审查和更新文档，确保文档与实际情况一致

### 11.3 文档示例

```markdown
# 模块名称

## 1. 概述

简要描述模块的功能和用途

## 2. 功能特性

- 特性1
- 特性2
- 特性3

## 3. 使用方法

```python
# 示例代码
from module import function

result = function(param1, param2)
print(result)
```

## 4. API文档

### 4.1 函数1

```python
def function1(param1, param2):
    """
    函数描述
    
    Args:
        param1: 参数1描述
        param2: 参数2描述
    
    Returns:
        返回值描述
    
    Raises:
        ExceptionType: 异常描述
    """
```
```

## 12. 总结

本指南为AI智能体提供了结构化、可执行的工作框架，确保AI智能体在执行项目任务时严格遵循项目管理规范，保证工作质量和可追溯性。AI智能体应始终：

- 遵循项目的代码规范和最佳实践
- 保持良好的工作习惯和沟通方式
- 及时记录工作进展和决策
- 积极响应人工审阅反馈
- 持续改进工作流程和方法

通过严格遵循本指南，AI智能体将能够高效、高质量地完成项目任务，为项目的成功做出贡献。